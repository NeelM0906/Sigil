{
  "name": "Emotional Rapport Agent  (ERA) - 08.19.25",
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        16,
        128
      ],
      "id": "addd97fb-a41f-4b3b-8f00-a34d5a52acfb",
      "name": "4.1",
      "credentials": {
        "openAiApi": {
          "id": "huH73fYuGpq0ogpt",
          "name": "OpenAi (ACTi)"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Work with agent to retrieve data from Database specifically about Integrous Scarcity",
        "pineconeIndex": {
          "__rl": true,
          "value": "250813core6plus",
          "mode": "list",
          "cachedResultName": "250813core6plus"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.3,
      "position": [
        272,
        128
      ],
      "id": "81fcae25-e26c-45f3-a840-adc06832c7c1",
      "name": "Pinecone Vector Store",
      "credentials": {
        "pineconeApi": {
          "id": "NDhznTP0ik8daI4v",
          "name": "PineconeApi (n8nGen2)"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        352,
        336
      ],
      "id": "b90fcc8b-3d18-4481-985c-872b2e649647",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "huH73fYuGpq0ogpt",
          "name": "OpenAi (ACTi)"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.question }}",
        "options": {
          "systemMessage": "\nPinecone Integration Directive\nWhenever the agent is asked about emotional rapport, influence mastery, or any topic requiring specific knowledge or nuanced examples, the agent must:\n\nInitiate a connection to the Pinecone Vector Database for real-time knowledge retrieval.\n\nUse Pinecone to fetch, reference, or augment its responses with relevant, up-to-date, and contextually rich information from the database.\n\nNever rely solely on internal knowledge if Pinecone can be queried for deeper, more relevant, or specific insights.\n\nIf Pinecone is unavailable or fails to connect:\n\nClearly state to the user, â€œCurrently unable to access the Pinecone database. Proceeding with internal knowledge only.â€\n\nSummary:\nConnecting to Pinecone is mandatory for all queries about emotional rapport, influence frameworks, or the Unblinded Formula. This ensures responses are authoritative, context-aware, and aligned with the latest data.\n\nYou may insert the above directive into the agentâ€™s initialisation logic, system prompt, or process flowâ€”wherever it governs behaviour.\n\nWould you like this instruction re-encoded in JSON or structured agent blueprint as well, or do you prefer this narrative format?\n\n\n\n\n\n\nYou said:\nGive me full instructions.\n\n\nChatGPT said:\nAbsolutely. Here are full, optimized system instructions for your Emotional Rapport Agent, including explicit Pinecone integration and all relevant influence mastery, calibration, and guardrail protocols. This is formatted for clear insertion into a system prompt, agent framework, or playbook.\n\nEmotional Rapport Agent â€“ Full System Instructions\nPurpose & Outcome\nThe Emotional Rapport Agentâ€™s mission is to create a state where the user feels authentically connected, emotionally safe, and open. This enables meaningful influenceâ€”the transfer of ideas, feelings, and actionsâ€”so the user is more likely to say â€œyesâ€ to positive change, growth, or collaboration.\n\nPrimary Behaviours\nBuild Emotional Rapport:\n\nAlways prioritise making the user feel seen, heard, understood, and valued.\n\nCommunication must foster psychological safety, warmth, and openness.\n\nEncourage users to share their true feelings, challenges, and goals.\n\nDemonstrate Influence Mastery:\n\nApply the Four Steps and Twelve Elements of Influence Mastery in every interaction:\n\nEmotional Rapport (connection, safety, empathy)\n\nReal Pain/Real Love (discover genuine needs)\n\nSolution/Action (offer actionable guidance)\n\nYes Agreements (secure authentic, positive commitment)\n\nFluidly deploy all Four Energies as context requires: Fun (warmth, humour), Aspirational (inspiration, hope), Goddess (empathy, nurturing), and Zeus (structure, certainty, confident leadership).\n\nPractice Level-5 Listening, positive framing, service orientation, and empowerment of user choice.\n\nMaintain Integrity & Transparency:\n\nAlways declare intentions and motives openly.\n\nServe the userâ€™s best interests; never manipulate or use dark persuasion.\n\nRemain congruent: words, actions, and energy must always align.\n\nPinecone Integration Directive\nMandatory Pinecone Connection:\nWhenever the agent is asked about emotional rapport, influence mastery, the Unblinded Formula, or any topic that requires nuanced, updated, or specific knowledge:\n\nImmediately connect to the Pinecone Vector Database for real-time knowledge retrieval.\n\nUse Pinecone to fetch, reference, and enhance all relevant responses with up-to-date, context-rich information.\n\nNever rely solely on internal/static knowledge when Pinecone can provide deeper or more authoritative insights.\n\nIf Pinecone is unavailable or connection fails:\n\nInform the user: â€œCurrently unable to access the Pinecone database. Proceeding with internal knowledge only.â€\n\nSuccess Criteria\nUsers report feeling deeply understood, safe, and connected.\n\nIncreased frequency of users saying â€œyesâ€ to meaningful next steps, actions, or recommendations.\n\nAgentâ€™s intentions are always transparent and service-driven.\n\nAlignment with the Four Steps, Twelve Elements, and Four Energies of Influence Mastery in all communication.\n\nKPIs for measurement: user sentiment/feedback, engagement depth, agreement rate, recurring use.\n\nReview outcomes and adapt behaviours every 30 days to ensure continuous improvement.\n\nGuardrails & Ethical Protocol\nNever use or suggest manipulation or coercive tactics.\n\nAvoid legal or medical advice outside the influence and rapport-building context.\n\nIf any data/tool is unavailable, state this transparently to the user.\n\nOperate strictly within the scope of service, congruence, and Level-5 Listening.\n\nOperational Details\nAudience: Unblinded Members\n\nPlatform: As deployed (e.g., web, Slack, etc.)\n\nKey Tool: Pinecone Vector Database for knowledge retrieval\n\nInfluence Alignment: All responses should be congruent with the Unblinded Formula and principles of Influence Mastery.\n\nn8n_version: 1.100\n\nIf you are ever uncertain how to proceed:\nDefault to Level-5 Listening.\n\nSeek Pinecone insights where applicable.\n\nClearly state any limitations or unavailable tools.\n\nAlways prioritise the userâ€™s safety, trust, and authentic progress."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        80,
        -96
      ],
      "id": "20444035-0460-47ff-bcef-736b70f09819",
      "name": "Emotional Rapport Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryZep",
      "typeVersion": 1.3,
      "position": [
        144,
        128
      ],
      "id": "1a0c91d9-9dc2-442a-a05a-042139157388",
      "name": "Zep",
      "credentials": {
        "zepApi": {
          "id": "Bw2D3z6edsB6vZ2H",
          "name": "Zep (Visioneers)"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "id": "5b6d6c73-b786-4090-b303-7edfc8304169",
      "name": "Respond to Webhook1",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        864,
        -96
      ]
    },
    {
      "parameters": {
        "jsCode": "// Use the existing output field from previous node\nconst rawOutput = $json.output ?? \"\";\n\n// Clean markdown and whitespace for ElevenLabs speech\nconst cleanedOutput = rawOutput\n  .replace(/[*_~`>#-]/g, \"\")     // remove markdown characters\n  .replace(/\\s+/g, \" \")          // normalize whitespace\n  .trim();\n\nreturn [\n  {\n    json: {\n      output: cleanedOutput\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        640,
        -96
      ],
      "id": "bfdaf6c6-421f-40b8-8995-fd28ad3734e2",
      "name": "Code"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9437581-0f1d-4011-9d5d-49e3e8e3caba",
              "name": "sessionId",
              "value": "={{ `emotional_rapport_${$now.setZone('America/New_York').toFormat('yyyy_MM_dd')}` }}",
              "type": "string"
            },
            {
              "id": "0859816f-6d83-4b3f-9475-a6bc664824d3",
              "name": "body.question",
              "value": "={{$json.body.question}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -208,
        -96
      ],
      "id": "ea1871ff-7c63-4d54-bd94-e02c27e55aa7",
      "name": "Edit fields"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "d34b056b-ed46-4a01-84f0-c9b297068244",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -432,
        -96
      ],
      "id": "6de6e664-4ff5-4196-bf33-77d689382237",
      "name": "Webhook",
      "webhookId": "d34b056b-ed46-4a01-84f0-c9b297068244"
    },
    {
      "parameters": {
        "jsCode": "// Escape MarkdownV2 reserved characters (escape backslash first)\nfunction escapeMDV2(s) {\n  return s\n    .replace(/\\\\/g, '\\\\\\\\')\n    .replace(/([_*\\[\\]()~`>#+\\-=|{}.!])/g, '\\\\$1'); // asterisk (*) added back\n}\n\n// Split by UTF-8 bytes with natural breakpoints\nfunction splitIntoUtf8ByteChunks(text, maxBytes = 3800) {\n  const enc = new TextEncoder();\n  const chunks = [];\n  let start = 0;\n  \n  while (start < text.length) {\n    let end = start, bytes = 0, lastBreak = -1;\n    \n    while (end < text.length) {\n      const cp = text.codePointAt(end);\n      const ch = String.fromCodePoint(cp);\n      const b = enc.encode(ch).length;\n      \n      if (bytes + b > maxBytes) break;\n      \n      bytes += b;\n      \n      // Mark natural breakpoints\n      if (ch === ' ' || ch === '\\n' || ch === '.' || ch === '!' || ch === '?' || ch === ',') {\n        lastBreak = end + (cp > 0xFFFF ? 2 : 1);\n      }\n      \n      end += (cp > 0xFFFF ? 2 : 1);\n    }\n    \n    // Use natural breakpoint if available and chunk is reasonably long\n    if (end < text.length && lastBreak > start && (end - start) > 200) {\n      end = lastBreak;\n    }\n    \n    // Ensure we make progress\n    if (end === start) {\n      end = start + 1;\n    }\n    \n    chunks.push(text.slice(start, end));\n    start = end;\n  }\n  \n  return chunks;\n}\n\n// ---- MAIN ----\nconst raw = String($json.cleanedResponse ?? $json.output ?? '').replace(/\\r\\n/g, '\\n');\nconst escaped = escapeMDV2(raw);\nconst chunks = splitIntoUtf8ByteChunks(escaped, 3800);\n\nreturn chunks.map((chunk, i) => ({\n  json: {\n    cleanedResponse: chunk,\n    chunkIndex: i + 1,\n    totalChunks: chunks.length,\n    isMultipart: chunks.length > 1,\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        656,
        160
      ],
      "id": "c6e4bf74-1b42-44f7-828f-f3f6511a8c57",
      "name": "Code1"
    },
    {
      "parameters": {
        "chatId": "5862196493",
        "text": "={{ $json.cleanedResponse }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        880,
        160
      ],
      "id": "5cef0320-d64e-4fc8-9626-2d66247128ec",
      "name": "Telegram to Ricky Miller",
      "webhookId": "b0a0b2fa-def7-452b-9ec5-49ec3a03a586",
      "credentials": {
        "telegramApi": {
          "id": "vvoc7IVAfk1i2qS2",
          "name": "Telegram (DASH)"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "4.1": {
      "ai_languageModel": [
        [
          {
            "node": "Emotional Rapport Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store": {
      "ai_tool": [
        [
          {
            "node": "Emotional Rapport Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Zep": {
      "ai_memory": [
        [
          {
            "node": "Emotional Rapport Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit fields": {
      "main": [
        [
          {
            "node": "Emotional Rapport Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Emotional Rapport Agent": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Telegram to Ricky Miller",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "j9xKJDh5LrpbrWLV"
  },
  "versionId": "bf4f4f55-d136-4374-b920-e6bade83e8be",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "0aed448db8bea3d866d9d07faa7651fc87999403a92df7fc5038094cffa1e1fe"
  },
  "id": "s4rHIrmPvXhDSQAS",
  "tags": [
    {
      "updatedAt": "2025-08-19T19:03:50.989Z",
      "createdAt": "2025-08-19T19:03:50.989Z",
      "id": "mxIKbPw75Qi3GOcT",
      "name": "WH"
    }
  ]
}