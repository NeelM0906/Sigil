{
  "name": "Agreement Formation Agent (BOND) - 08.19.25",
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -80,
        160
      ],
      "id": "8a726929-c9b9-4d58-84ce-c707decaf6a7",
      "name": "4.1",
      "credentials": {
        "openAiApi": {
          "id": "huH73fYuGpq0ogpt",
          "name": "OpenAi (ACTi)"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Work with agent to retrieve data from Database specifically about agreement formation",
        "pineconeIndex": {
          "__rl": true,
          "value": "250813core6plus",
          "mode": "list",
          "cachedResultName": "250813core6plus"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.3,
      "position": [
        176,
        160
      ],
      "id": "2a84e081-1618-4fea-8eb0-7477c120d2f7",
      "name": "Pinecone Vector Store",
      "credentials": {
        "pineconeApi": {
          "id": "NDhznTP0ik8daI4v",
          "name": "PineconeApi (n8nGen2)"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        256,
        368
      ],
      "id": "b90d2243-1e42-4ef3-b2c5-a7a588b7c32a",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "huH73fYuGpq0ogpt",
          "name": "OpenAi (ACTi)"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.question }}",
        "options": {
          "systemMessage": "Optimized System Prompt (for n8n + Pinecone Agreement Formation Agent):\n\n**You are the Agreement Formation Agentâ€”a voice-first, mastery-level AI trained in the Unblinded 4-Step Communication Model for ethical influence.\nYour mission is to guide, teach, and coach users to mastery of agreement formation, using only data and knowledge retrieved from the Pinecone vector store (Unblinded curriculum, live examples, objection drills, user logs).\n\nAdhere to these protocols at all times:\n\nEmbody â€œZeusâ€ authority and â€œAspirationalâ€ encouragementâ€”be clear, empowering, and unshakeably congruent.\n\nAlways start with emotional rapport and progress through the 4-Step Model: Emotional Rapport, Truth to Pain, Heroic Unique Identity, Agreement Formation.\n\nGive feedback based on Level 5 Listening and energetic congruence.\n\nUse micro-agreement sequencingâ€”never leap straight to big asks.\n\nWhen coaching or responding, always root your answers in Pinecone-retrieved data.\n\nTie recommendations and practice to the userâ€™s real priorities: money, time, or magic.\n\nWhen prompted, offer user-specific learning modes: â€œPrecisionâ€ (step-by-step), â€œDynamicâ€ (scenarios/examples), â€œGrowthâ€ (actionable drills).\n\nRefuse any request outside ethical influence, learning, and agreement formation. Do not give legal, medical, or manipulative advice.\n\nIf context is missing or data is unclear, ask clarifying questions before responding.\n\nUltimate goal:\nEvery user is empowered to master, apply, and teach agreement formation, with integrity and real-world results.\n\nResponses must always reflect the Unblinded Model and retrieved Pinecone data. Never fabricate or improvise outside this knowledge base.**"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -32,
        -64
      ],
      "id": "4578065e-54df-404f-887d-8c6bca92d645",
      "name": "Agreement Formation"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryZep",
      "typeVersion": 1.3,
      "position": [
        48,
        160
      ],
      "id": "6d76f494-176c-4b50-9465-e9c094580c8b",
      "name": "Zep",
      "credentials": {
        "zepApi": {
          "id": "Bw2D3z6edsB6vZ2H",
          "name": "Zep (Visioneers)"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "id": "f64ae74a-5577-42b1-83a4-d3844c74261d",
      "name": "Respond to Webhook1",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        768,
        -64
      ]
    },
    {
      "parameters": {
        "jsCode": "// Use the existing output field from previous node\nconst rawOutput = $json.output ?? \"\";\n\n// Clean markdown and whitespace for ElevenLabs speech\nconst cleanedOutput = rawOutput\n  .replace(/[*_~`>#-]/g, \"\")     // remove markdown characters\n  .replace(/\\s+/g, \" \")          // normalize whitespace\n  .trim();\n\nreturn [\n  {\n    json: {\n      output: cleanedOutput\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        544,
        -64
      ],
      "id": "4c08be72-0b1c-40f8-8d85-ce7c26bb67df",
      "name": "Code"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9437581-0f1d-4011-9d5d-49e3e8e3caba",
              "name": "sessionId",
              "value": "={{ `agreement_formation_${$now.setZone('America/New_York').toFormat('yyyy_MM_dd')}` }}",
              "type": "string"
            },
            {
              "id": "0859816f-6d83-4b3f-9475-a6bc664824d3",
              "name": "body.question",
              "value": "={{$json.body.question}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -304,
        -64
      ],
      "id": "e3ce9861-beea-4cf4-9034-4ef75f03d000",
      "name": "Edit fields"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "f7e60fcf-03f2-4fb4-bd18-ac99d1b9c784",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -544,
        -64
      ],
      "id": "cf7f517a-c7db-4aa5-b2c1-d98afa9597db",
      "name": "Webhook",
      "webhookId": "f7e60fcf-03f2-4fb4-bd18-ac99d1b9c784"
    }
  ],
  "pinData": {},
  "connections": {
    "4.1": {
      "ai_languageModel": [
        [
          {
            "node": "Agreement Formation",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store": {
      "ai_tool": [
        [
          {
            "node": "Agreement Formation",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Zep": {
      "ai_memory": [
        [
          {
            "node": "Agreement Formation",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit fields": {
      "main": [
        [
          {
            "node": "Agreement Formation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agreement Formation": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "j9xKJDh5LrpbrWLV"
  },
  "versionId": "1601c86e-592c-4746-a6d6-369b5e74dec1",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "0aed448db8bea3d866d9d07faa7651fc87999403a92df7fc5038094cffa1e1fe"
  },
  "id": "jZ8DtQ1nPlHXDe1i",
  "tags": [
    {
      "updatedAt": "2025-08-19T19:03:50.989Z",
      "createdAt": "2025-08-19T19:03:50.989Z",
      "id": "mxIKbPw75Qi3GOcT",
      "name": "WH"
    }
  ]
}