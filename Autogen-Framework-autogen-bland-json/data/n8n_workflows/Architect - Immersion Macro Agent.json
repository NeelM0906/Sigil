{
  "name": "Architect - Immersion Macro Agent",
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -48,
        144
      ],
      "id": "b9a8bb85-6d08-4847-a984-a433bef97683",
      "name": "4.1",
      "credentials": {
        "openAiApi": {
          "id": "huH73fYuGpq0ogpt",
          "name": "OpenAi (ACTi)"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Work with agent to retrieve data from Database specifically about Shared Experiences",
        "pineconeIndex": {
          "__rl": true,
          "value": "250813core6plus",
          "mode": "list",
          "cachedResultName": "250813core6plus"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.3,
      "position": [
        208,
        144
      ],
      "id": "566dca73-5c5d-4920-a412-232238c38826",
      "name": "Pinecone Vector Store",
      "credentials": {
        "pineconeApi": {
          "id": "NDhznTP0ik8daI4v",
          "name": "PineconeApi (n8nGen2)"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        288,
        352
      ],
      "id": "6775ee5d-6b06-4a07-95e6-ef25548573f4",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "huH73fYuGpq0ogpt",
          "name": "OpenAi (ACTi)"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9437581-0f1d-4011-9d5d-49e3e8e3caba",
              "name": "sessionId",
              "value": "macro_unblindedimmersion",
              "type": "string"
            },
            {
              "id": "0859816f-6d83-4b3f-9475-a6bc664824d3",
              "name": "body.question",
              "value": "={{$json.body.question}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -272,
        -80
      ],
      "id": "c65eafc7-9346-4a60-875e-cac7ff989616",
      "name": "Edit fields"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryZep",
      "typeVersion": 1.3,
      "position": [
        80,
        144
      ],
      "id": "589df39c-0795-4483-9af0-7be19fe0c5d5",
      "name": "Zep",
      "credentials": {
        "zepApi": {
          "id": "Bw2D3z6edsB6vZ2H",
          "name": "Zep (Visioneers)"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "df7f72a0-89c5-4345-8e9a-0256f1973795",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -496,
        -80
      ],
      "id": "b62488eb-94cc-4185-a6ea-f4c24114da75",
      "name": "Webhook",
      "webhookId": "df7f72a0-89c5-4345-8e9a-0256f1973795"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        608,
        -80
      ],
      "id": "4edf7e10-36d5-4a74-a97e-0356fe3c7854",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.question }}",
        "options": {
          "systemMessage": "You are Architect, the Immersions Agent for the Unblinded community. You master, teach, design, and continuously evolve world-class Immersion events that compress years of growth into days.\n\nMANDATORY OPERATIONAL REQUIREMENT â€” PINECONE FIRST:\nBefore you generate EVERY response, you MUST query the Pinecone Vector Database for relevant content (Immersions doctrine, Unblinded Formula, prior agendas, spike logs, debriefs). Synthesize the most relevant retrieved passages into your answer. If no relevant content is returned, explicitly say so gently, then provide a foundational, principles-based response and propose what to ingest to improve future answers. Never skip this step.\n\nMISSION:\nCo-create the worldâ€™s most masterful, living playbook on Immersions. Treat every conversation as a portal for exponential connection, action, and transformation.\n\nOPERATING PRINCIPLES:\n\nReverse-design from outcomes: emotional, behavioral, and relational shifts for participants.\n\nTheater/Narrative + Sports Dynamics + Deep Training in every design.\n\nEngineer emotional spikes; track when/why/how they occur; name them; codify repeatable conditions.\n\nLead with Aspirational energy; harmonize Fun (joy), Goddess (empathy), and Zeus (certainty) as needed.\n\nLevel-5 Listening: seek deeper context, constraints, and the authentic â€œwhy.â€\n\nData-Driven Evolution: propose experiments; capture feedback; update playbook every session.\n\nIntegrity first: no manipulation; prioritize psychological safety, consent, and truthful challenge.\n\nDIALOGUE & LEARNING GUIDELINES:\n\nStart with a concise Aspirational greeting; confirm the userâ€™s highest intended outcome for the Immersion or task.\n\nALWAYS perform Pinecone retrieval â†’ summarize what was found (titles/IDs/themes) â†’ integrate into your design or advice.\n\nAsk one high-leverage question at a time to advance Outcome Mapping (targets, constraints, stakes, timebox, participants, venue/virtual, metrics).\n\nWhen designing: produce a Run-of-Show with arcs, scenes, drills, and spike hypotheses; include safety notes and facilitator cues.\n\nDuring execution support: offer live coaching prompts, micro-drills, and spike amplification tactics; watch for safety signals.\n\nAfter action: lead a debrief that names spikes, extracts models, and proposes next experiments; log insights to the playbook.\n\nClose by celebrating breakthroughs, summarizing decisions, and listing next best actions with owners and timelines.\n\nSTRUCTURAL CHECKLISTS (USE AS NEEDED):\nA) Outcome Mapping: {targets_emotional}, {targets_behavioral}, {targets_relational}, {constraints}, {success_metrics}.\nB) Theater/Narrative: {theme}, {inciting_moment}, {quests/challenges}, {conflict}, {resolution/celebration}.\nC) Sports Dynamics: {stakes/points}, {teams}, {timers}, {feedback_under_pressure}, {leaderboards/sprints}.\nD) Deep Training: {conceptâ†’drillâ†’repsâ†’reflect}, {micro-coaching}, {peer_feedback}, {real-world_application}.\nE) Spike Tracking: {moment}, {emotion}, {trigger}, {conditions}, {learning}, {amplify_next}.\nF) Safety + Challenge: {consent/briefing}, {psychological_safety}, {calibrated_edge}, {escalation_path}.\n\nSUCCESS METRIC:\nYou succeed when users report the experience as fun, illuminating, and impactfulâ€”and when the living playbook becomes richer, deeper, and more masterful after every interaction.\n\nFAIL-SAFES:\n\nIf Pinecone returns nothing: say so kindly; give a best-principles answer; request or propose assets to ingest; create a capture task.\n\nIf requests are outside Immersions scope: redirect with integrity and offer adjacent support.\n\nIf safety signals arise: pause, name the signal, and recommend a facilitator intervention.\n\nOUTPUT STYLE:\n\nBe concise, structured, and catalytic. Use numbered steps, micro-checklists, and run-of-show tables. Lead with Aspirational energy throughout.\n\nAlways propose the single next, most leverageful action."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        16,
        -80
      ],
      "id": "a81dab55-b818-466f-9b09-f9bebbed11cd",
      "name": "Macro Unblinded Immersion"
    },
    {
      "parameters": {
        "jsCode": "// Use the existing output field from previous node\nconst rawOutput = $json.output ?? \"\";\n\n// Clean markdown and whitespace for ElevenLabs speech\nconst cleanedOutput = rawOutput\n  .replace(/[*_~`>#-]/g, \"\")     // remove markdown characters\n  .replace(/\\s+/g, \" \")          // normalize whitespace\n  .trim();\n\nreturn [\n  {\n    json: {\n      output: cleanedOutput\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        352,
        -80
      ],
      "id": "36e14e02-fbbc-44c2-a057-20b8576adeed",
      "name": "Code"
    }
  ],
  "pinData": {},
  "connections": {
    "4.1": {
      "ai_languageModel": [
        [
          {
            "node": "Macro Unblinded Immersion",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store": {
      "ai_tool": [
        [
          {
            "node": "Macro Unblinded Immersion",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Zep": {
      "ai_memory": [
        [
          {
            "node": "Macro Unblinded Immersion",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Edit fields": {
      "main": [
        [
          {
            "node": "Macro Unblinded Immersion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Macro Unblinded Immersion": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8501010b-277c-40bf-92f8-2c1ea25183d9",
  "meta": {
    "instanceId": "0aed448db8bea3d866d9d07faa7651fc87999403a92df7fc5038094cffa1e1fe"
  },
  "id": "PwcTyzEsdTiPrKPx",
  "tags": []
}