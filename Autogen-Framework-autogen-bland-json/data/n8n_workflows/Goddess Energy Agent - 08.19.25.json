{
  "name": "Goddess Energy Agent - 08.19.25",
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -48,
        352
      ],
      "id": "9a4663f1-252e-4775-9588-56d10ff6918d",
      "name": "4.1",
      "credentials": {
        "openAiApi": {
          "id": "huH73fYuGpq0ogpt",
          "name": "OpenAi (ACTi)"
        }
      }
    },
    {
      "parameters": {
        "content": "## Goddess Energy Agent",
        "height": 624,
        "width": 544
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -80,
        80
      ],
      "typeVersion": 1,
      "id": "38e2769e-6e37-412d-b310-9bbceb441ffc",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        288,
        560
      ],
      "id": "99187201-8722-4d79-9ea8-9689c89353a8",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "huH73fYuGpq0ogpt",
          "name": "OpenAi (ACTi)"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{  $json.body.question }}",
        "options": {
          "systemMessage": "You are â€œGoddess Energyâ€ â€” a voice-interactive AI agent for Influence Mastery, specializing in teaching and embodying Goddess Energy.\n\n## Purpose\nYour purpose is to help users master the art and science of Goddess Energy â€” the fusion of unconditional love, sacred boundaries, and deep presence â€” using both nurturing guidance and actionable practice. Always reference and retrieve relevant information, stories, and examples from the Pinecone Vector Store when responding.\n\n## Guidelines\nInfuse every response with warmth, grace, compassion, and the calm authority of sacred boundaries.\n\nGuide users through learning, practicing, and reflecting on Goddess Energy skills, drawing from the Influence Mastery curriculum and Pinecone context.\n\nUse parables, grounding exercises, affirmations, boundary scripts, and archetypal stories to deepen understanding and inspire transformation.\n\nRetrieve, cite, or reference specific, contextually relevant material from Pinecone â€” especially user-referenced topics (e.g. sacred boundaries, holding space, Galadriel archetype).\n\nBlend Goddess Energy with Aspirational, Zeus, or Fun energies only when the context calls for it.\n\nEncourage integration of insight into real-life situations; honour attempts and growth, even if imperfect.\n\nModel congruence, integrity, and value creation in every response.\n\nIf user input is unclear or insufficient, ask a clarifying question with empathy and curiosity.\n\nNever apply guilt or pressure; maintain a safe, non-judgemental atmosphere where transformation feels possible.\n\nAlways act in accordance with n8n v1.105 conventions.\n\n## PINECONE INTEGRATION [MANDATORY]\n\nCRITICAL: You MUST query Pinecone Vector Store, Goddess Energy Brain, before ANY response.\nThis is not optional. Every response REQUIRES:\n1. Pinecone retrieval executed FIRST\n2. Minimum 3 patterns extracted from results  \n3. Retrieved examples woven throughout response\n4. Success patterns applied as primary guidance\n\n## Session Goals\nLeave the user feeling grounded, seen, and empowered to embody Goddess Energy in real life.\nInvite them to share experiences, reflect on insights, and celebrate their progress.\n\nYou are the living embodiment of Goddess Energy. Begin every session with calm presence and wise empathy â€” and ensure every interaction leaves a lasting imprint of safety, inspiration, and transformation."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        16,
        128
      ],
      "id": "982f4b53-e15d-47d8-b382-251486e57b14",
      "name": "Goddess Energy Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryZep",
      "typeVersion": 1.3,
      "position": [
        80,
        352
      ],
      "id": "d8f02ec1-5dd3-45eb-9131-cb8342dbe373",
      "name": "Zep",
      "credentials": {
        "zepApi": {
          "id": "Bw2D3z6edsB6vZ2H",
          "name": "Zep (Visioneers)"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "id": "3422f3df-f524-418e-852b-455fa9cfc6a3",
      "name": "Respond to Webhook1",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        800,
        32
      ]
    },
    {
      "parameters": {
        "jsCode": "// Use the existing output field from previous node\nconst rawOutput = $json.output ?? \"\";\n\n// Clean markdown and whitespace for ElevenLabs speech\nconst cleanedOutput = rawOutput\n  .replace(/[*_~`>#-]/g, \"\")     // remove markdown characters\n  .replace(/\\s+/g, \" \")          // normalize whitespace\n  .trim();\n\nreturn [\n  {\n    json: {\n      output: cleanedOutput\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        576,
        32
      ],
      "id": "2138cbbd-373a-4eff-9c8f-5028ad389772",
      "name": "Code"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9437581-0f1d-4011-9d5d-49e3e8e3caba",
              "name": "sessionId",
              "value": "={{ `goddess_energy_${$now.setZone('America/New_York').toFormat('yyyy_MM_dd')}` }}",
              "type": "string"
            },
            {
              "id": "0859816f-6d83-4b3f-9475-a6bc664824d3",
              "name": "body.question",
              "value": "={{$json.body.question}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -272,
        128
      ],
      "id": "db667f4b-e2ea-46a1-a4b1-ad6a500780af",
      "name": "Edit fields"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "6fd0deb5-ae1c-4645-b7f4-a734e53871d3",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -496,
        128
      ],
      "id": "19f7648a-897d-46df-9c0d-a44919749c4f",
      "name": "Webhook",
      "webhookId": "6fd0deb5-ae1c-4645-b7f4-a734e53871d3"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Provide information supporting the decision of Apex Actualizer",
        "pineconeIndex": {
          "__rl": true,
          "value": "250813core6plus",
          "mode": "list",
          "cachedResultName": "250813core6plus"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.3,
      "position": [
        208,
        352
      ],
      "id": "8a2c04a1-2528-46cf-ae3f-42f2c1865997",
      "name": "Goddess Energy Brain",
      "credentials": {
        "pineconeApi": {
          "id": "NDhznTP0ik8daI4v",
          "name": "PineconeApi (n8nGen2)"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Escape MarkdownV2 reserved characters (escape backslash first)\nfunction escapeMDV2(s) {\n  return s\n    .replace(/\\\\/g, '\\\\\\\\')\n    .replace(/([_*\\[\\]()~`>#+\\-=|{}.!])/g, '\\\\$1'); // asterisk (*) added back\n}\n\n// Split by UTF-8 bytes with natural breakpoints\nfunction splitIntoUtf8ByteChunks(text, maxBytes = 3800) {\n  const enc = new TextEncoder();\n  const chunks = [];\n  let start = 0;\n  \n  while (start < text.length) {\n    let end = start, bytes = 0, lastBreak = -1;\n    \n    while (end < text.length) {\n      const cp = text.codePointAt(end);\n      const ch = String.fromCodePoint(cp);\n      const b = enc.encode(ch).length;\n      \n      if (bytes + b > maxBytes) break;\n      \n      bytes += b;\n      \n      // Mark natural breakpoints\n      if (ch === ' ' || ch === '\\n' || ch === '.' || ch === '!' || ch === '?' || ch === ',') {\n        lastBreak = end + (cp > 0xFFFF ? 2 : 1);\n      }\n      \n      end += (cp > 0xFFFF ? 2 : 1);\n    }\n    \n    // Use natural breakpoint if available and chunk is reasonably long\n    if (end < text.length && lastBreak > start && (end - start) > 200) {\n      end = lastBreak;\n    }\n    \n    // Ensure we make progress\n    if (end === start) {\n      end = start + 1;\n    }\n    \n    chunks.push(text.slice(start, end));\n    start = end;\n  }\n  \n  return chunks;\n}\n\n// ---- MAIN ----\nconst raw = String($json.cleanedResponse ?? $json.output ?? '').replace(/\\r\\n/g, '\\n');\nconst escaped = escapeMDV2(raw);\nconst chunks = splitIntoUtf8ByteChunks(escaped, 3800);\n\nreturn chunks.map((chunk, i) => ({\n  json: {\n    cleanedResponse: chunk,\n    chunkIndex: i + 1,\n    totalChunks: chunks.length,\n    isMultipart: chunks.length > 1,\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        576,
        224
      ],
      "id": "ae4f2a3b-dbd3-4f56-a0d8-6ed4c18a60de",
      "name": "Prepare for Dash"
    },
    {
      "parameters": {
        "chatId": "7755247869",
        "text": "={{ $json.cleanedResponse }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        800,
        224
      ],
      "id": "0e33b1d6-3df8-467e-bede-576dae31af55",
      "name": "Telegram to Dr. Val",
      "webhookId": "b0a0b2fa-def7-452b-9ec5-49ec3a03a586",
      "credentials": {
        "telegramApi": {
          "id": "vvoc7IVAfk1i2qS2",
          "name": "Telegram (DASH)"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -640,
        352
      ],
      "id": "32f5c1be-dc2d-465b-ac0c-128a6cfa3bf2",
      "name": "When chat message received",
      "webhookId": "e113f6b9-6033-4cab-95ba-b2804a247a15"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9437581-0f1d-4011-9d5d-49e3e8e3caba",
              "name": "sessionId",
              "value": "goddess_energy_2025_08_31",
              "type": "string"
            },
            {
              "id": "0859816f-6d83-4b3f-9475-a6bc664824d3",
              "name": "body.question",
              "value": "={{ $json.chatInput }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -240,
        352
      ],
      "id": "e071a9ec-66f4-4421-bb5b-aff7795a25c4",
      "name": "Edit fields3"
    }
  ],
  "pinData": {},
  "connections": {
    "4.1": {
      "ai_languageModel": [
        [
          {
            "node": "Goddess Energy Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Goddess Energy Brain",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Zep": {
      "ai_memory": [
        [
          {
            "node": "Goddess Energy Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit fields": {
      "main": [
        [
          {
            "node": "Goddess Energy Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Goddess Energy Agent": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare for Dash",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Goddess Energy Brain": {
      "ai_tool": [
        [
          {
            "node": "Goddess Energy Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Dash": {
      "main": [
        [
          {
            "node": "Telegram to Dr. Val",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Edit fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit fields3": {
      "main": [
        []
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "j9xKJDh5LrpbrWLV"
  },
  "versionId": "57594f9e-7296-44ba-b18a-656b0182d94c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "0aed448db8bea3d866d9d07faa7651fc87999403a92df7fc5038094cffa1e1fe"
  },
  "id": "tRtDAbb12HmWAAeX",
  "tags": [
    {
      "updatedAt": "2025-08-19T19:03:50.989Z",
      "createdAt": "2025-08-19T19:03:50.989Z",
      "id": "mxIKbPw75Qi3GOcT",
      "name": "WH"
    }
  ]
}